<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="记录学习、工作、生活"><title>vue 单文件探索 | 李茶德的日记</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.0/styles/stackoverflow-dark.min.css"><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.0/highlight.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/img/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">vue 单文件探索</h1><a id="logo" href="/.">李茶德的日记</a><p class="description">记录学习、工作、生活</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa null"> 首页</i></a><a href="/archives/"><i class="fa null"> 归档</i></a><a href="/about/"><i class="fa null"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1"><div class="content_container"><div class="post"><h1 class="post-title">vue 单文件探索</h1><div class="post-meta">2018-09-04<span> | </span><span class="category"><a href="/categories/前端/">前端</a></span></div><div class="post-content"><p>以 vue 作为开发技术栈的前端开发者，往往会配合前端构建工具，进行项目的工程化管理。比如，大家常用的 vue 全家桶 + webpack 的方案进行一些中大型前端项目的开发。配合 webpack 后，vue 的组件化优势更加明显，我们可以通过单文件的组件化开发方式，在工作实践中搭建前端页面，从而提高开发效率。<a id="more"></a> 有这样一个问题：<strong>“当我们在写 vue 单文件时，我们在写什么？”</strong> 很多人可能会这样回答：template 负责模板，javascript 负责逻辑，style 负责样式。当回答到这里时，一个 vue 开发者的世界观基本上算是很明确了。我们要做的就是在一个单文件组件中写 template、javascript、style。如果仅仅局限于此，显然我们无法从更好的利用的单文件组件服务我们的整个开发流程。接下来我将和大家讨论在 vue 单文件开发中的一些方法论的问题。</p>
<h2 id="vue-单文件本质"><a href="#vue-单文件本质" class="headerlink" title="vue 单文件本质"></a>vue 单文件本质</h2><p>vue单文件是以特定文件扩展名 <code>.vue</code> 命名的文件。如下所示的代码：</p>
<p>ListDemo.vue<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;template&gt;<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-demo"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in list"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.key"</span>&gt;</span>&#123;&#123;item.value&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'ListNav'</span>,<br>    data() &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-attr">list</span>: [<br>                &#123; <span class="hljs-attr">key</span>: <span class="hljs-string">'home'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'首页'</span> &#125;,<br>                &#123; <span class="hljs-attr">key</span>: <span class="hljs-string">'category'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'文章分类'</span> &#125;,<br>                &#123; <span class="hljs-attr">key</span>: <span class="hljs-string">'tags'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'标签'</span> &#125;,<br>                &#123; <span class="hljs-attr">key</span>: <span class="hljs-string">'about'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'关于我'</span> &#125;,<br>                &#123; <span class="hljs-attr">key</span>: <span class="hljs-string">'links'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'友情链接'</span>&#125;,<br>            ],<br>        &#125;;<br>    &#125;,<br>&#125;;<br></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><br>.list-demo &#123;<br>    font-size: 14px;<br>&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure></p>
<p>代码中含有 template，script，style。三者的作用此处就不在赘述，如上的结构展示了一个 vue 单文件基本的文件结构。其背后的理念就是一个单文件组件对应了一个功能性组件，该组件的模板，样式，业务逻辑都采用就近维护的思想。从组件的复用性，后期可维护性的角度上来说，这样的理念都大大的提高了组件化的开发效率。vue 的单文件，既不是 js，也不是 html，也不是 css 文件，这样的文件如何被应用到页面上，这也就是下面将会说到的一个问题，vue 单文件是如何被处理成页面中可用的资源。</p>
<h2 id="vue-单文件被处理的流程"><a href="#vue-单文件被处理的流程" class="headerlink" title="vue 单文件被处理的流程"></a>vue 单文件被处理的流程</h2><p>vue 单文件配合 webpack 构建工具，在 webpack 中会交由 vue-loader 来处理。如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&#123;<br>    test: /\.vue$/,<br>    loader: &apos;vue-loader&apos;,<br>&#125;<br></code></pre></td></tr></table></figure>
<p>项目中通过 import 或者 require 引入的 vue 单文件，都会经过 vue-loader 处理，vue-loader 在这个过程中会将模板按照 template、script、style 解析并将处理结果返回，三种不同类型的文件交由接下来的loader 进行处理。如果该单文件组件在父组件中的 components 声明，则 components 中对应的该项会被插入解析后 script 代码。这个过程从入口文件 <code>main.js</code> 开始，所有涉及的被依赖单文件组件依次经历这样的处理过程。之后所有的组件的实例化将根据业务逻辑中的依赖关系进行，这个过程也是我们平时在开发中经常用到的一种方式。（这里可以单拉一篇文章详细讲述 vue-loader 的处理流程）</p>
<h2 id="单文件的常用姿势"><a href="#单文件的常用姿势" class="headerlink" title="单文件的常用姿势"></a>单文件的常用姿势</h2><h3 id="模板中的组件引用"><a href="#模板中的组件引用" class="headerlink" title="模板中的组件引用"></a>模板中的组件引用</h3><p>一、使用方式</p>
<p>组件的拆分和嵌套：</p>
<ul>
<li>将具体的业务按照功能以及后期复用性方面的考虑划分成更小的组件</li>
<li>通过一个容器组件（父组件）将小的功能组件（子组件）进行整合</li>
</ul>
<p>操作手法：父组件中引入子组件，components 中注册，template 中添加相应的组件引用模板</p>
<p>这种方式也是我们在进行单文件的开发中常用的一种方式，所有组件的实例化，都被隐含在组件的嵌套关系和业务逻辑中。开发者只需要关心组件的引入，在父组件逻辑中注册该组件，并在父组件的模板中以标签的方式引入组件。这个过程中待引入的组件的实例化时机也可以通过 v-if 指令在业务逻辑中进行控制。</p>
<p>二、适用场景</p>
<p>大部分场景下我们都可以通过这样的方式进行组件化的开发。这种模式的有一个特点： 组件的引入通过组件注册和模板中写入对应的组件的标签来完成。<strong>模板中通过标签来引入组件这一步必不可少</strong>，这个特点在某些业务场景下可能给开发者带来了一定的重复工作量。</p>
<h3 id="API-式的调用"><a href="#API-式的调用" class="headerlink" title="API 式的调用"></a>API 式的调用</h3><p>API 式的调用指的是手动创建子组件的实例，业务逻辑中无需引入组件和模板标签占位，在暴露的 API 中控制组件的实例化与显示。</p>
<p>一、使用方式</p>
<ul>
<li>功能模块提供一个入口 js 来控制该功能模块下单文件实例的所有功能逻辑</li>
<li>其他组件中使用该功能模块时，调用功能模块下的 js，传入部分参数</li>
</ul>
<p>操作手法： </p>
<p>Confirm.vue<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-dialg</span><br>        <span class="hljs-attr">title</span>=<span class="hljs-string">"test"</span><br>        <span class="hljs-attr">:visible.sync</span>=<span class="hljs-string">"visible"</span>&gt;</span><br>        &#123;&#123;content&#125;&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleCancelClick"</span>&gt;</span>cancel<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleOkClick"</span>&gt;</span>ok<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-dialg</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'Confirm'</span>,<br>    data() &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-attr">visible</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-attr">content</span>: <span class="hljs-string">'这是一个confirm dialog'</span>,<br>            <span class="hljs-attr">callback</span>: <span class="hljs-literal">null</span>,<br>        &#125;;<br>    &#125;,<br>    <span class="hljs-attr">methods</span>: &#123;<br>        handleCancelClick() &#123;<br>            <span class="hljs-keyword">this</span>.callback(<span class="hljs-string">'cancel'</span>);<br>        &#125;,<br>        handleOkClick() &#123;<br>            <span class="hljs-keyword">this</span>.callback(<span class="hljs-string">'confirm'</span>);<br>        &#125;,<br>    &#125;,<br>&#125;;<br></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></p>
<p>confirm.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;<br><span class="hljs-keyword">import</span> Confirm <span class="hljs-keyword">from</span> <span class="hljs-string">'./confirm'</span>;<br><br><span class="hljs-keyword">const</span> ConfirmConstructor = Vue.extend(Confirm);<br><br><span class="hljs-keyword">const</span> confirm = <span class="hljs-function">(<span class="hljs-params">content</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> confirmInstance = <span class="hljs-keyword">new</span> ConfirmConstructor(&#123;<br>        <span class="hljs-attr">data</span>: &#123;<br>            content,<br>        &#125;,<br>    &#125;);<br>    confirmInstance.vm = confirmInstance.$mount();<br>    confirmInstance.vm.visible = <span class="hljs-literal">true</span>;<br>    <span class="hljs-comment">// 手动插入目的 dom</span><br>    <span class="hljs-built_in">document</span>.body.appendChild(confirmInstance.vm.$el);<br>    confirmInstance.vm.callback = <span class="hljs-function"><span class="hljs-params">action</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>          resolve(action);<br>        &#125;);<br>    &#125;;<br>    <span class="hljs-keyword">return</span> confirmInstance.vm;<br>&#125;;<br></code></pre></td></tr></table></figure></p>
<p>如上所示，给出的是一个确认弹框的场景实现。确认弹框在很多用户交互中是一个必须的交互形式。很多组件库也采用上面这种 API 式的组件调用。调用方仅仅通过 api 的调用，就能实现该功能模块的引用。这样就避免了在 template 中通过标签占位的方式引用。实现原理就是手动接管单文件组件的实例化，通过 Vue.extend 获得该组件对应的 Vue 的子类，在暴露给调用的 api 中去实例化这个组件。这个过程中我们可能还要完成一些组件数据的注入，逻辑相关以及手动将该组件插入到目的 dom 中。手动的注入 dom 是该种方式的一个很大特点，通过在 api 中动态的注入目的 dom，避免我们在各个业务组件中调用该功能模块时重复性的在业务组件 template 中手写组件标签。</p>
<p>二、适用场景</p>
<ul>
<li>功能聚合度高，组件内逻辑简单，输入输出较为单一，比如一些功能较为独立的弹框</li>
<li>一些特殊的自定义指令开发，比如在一些特殊场景的指令，可以复用一些单文件组件，通过在指令的钩子中实例化组件对应的 vue 子类，按照特定的逻辑插入到目的 dom 中（例如：element-ui的v-loading）</li>
</ul>
<h3 id="区别和共性"><a href="#区别和共性" class="headerlink" title="区别和共性"></a>区别和共性</h3><p>共性：通过实例化对应组件完成组件的功能逻辑</p>
<p>区别：实例化的时机和方式不同。模板式的引入通过组件注册和标签引入的方式来使用单文件组件。标签引入解决了子组件插入的 dom 位置问题，开发者无需关心。API 式的单文件组件使用，在 API 调用时手动实例化组件，需要手动控制插入到目的 dom。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>vue 的单文件组件提供了 vue 的组件化开发思路，其本质在导出 vue 的一些关键属性，比如生命周期函数，methods，computed， watch，props等。我们可以通过上述两种方式来使用单文件组件，目的在于工程内部尽量减少重复的模板代码，组件解耦。</p>
</div><div class="tags"><a href="/tags/vue/">vue</a><a href="/tags/vue-loader/">vue-loader</a><a href="/tags/directives/">directives</a></div><div class="post-nav"><a href="/2019/12/21/the-summary-of-year-2019/" class="pre">即将过去的2019年</a><a href="/2018/03/13/Web Icon 实现方案总结/" class="next">Web Icon 实现方案总结</a></div></div></div></div><div class="pure-u-1"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">李茶德的日记.</a><a rel="nofollow" target="_blank" href="http://www.beian.miit.gov.cn"> 京ICP备17057625号.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>